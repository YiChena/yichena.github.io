(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{434:function(a,s,t){"use strict";t.r(s);var n=t(2),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"springcloud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#springcloud"}},[a._v("#")]),a._v(" SpringCloud")]),a._v(" "),s("h2",{attrs:{id:"nacos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos"}},[a._v("#")]),a._v(" Nacos")]),a._v(" "),s("p",[a._v("在bin目录下打开命令提示符 startup.cmd -m standalone")]),a._v(" "),s("h3",{attrs:{id:"nacos配置管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置管理"}},[a._v("#")]),a._v(" Nacos配置管理")]),a._v(" "),s("p",[a._v("配置管理-配置列表")]),a._v(" "),s("h4",{attrs:{id:"新建配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建配置"}},[a._v("#")]),a._v(" 新建配置")]),a._v(" "),s("p",[a._v("DataID ：服务名称-开发环境.yaml   例如：userservice-dev.yaml")]),a._v(" "),s("h4",{attrs:{id:"配置内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置内容"}},[a._v("#")]),a._v(" 配置内容")]),a._v(" "),s("p",[a._v("有变化的配置")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("pattern：\n\tdateformat：yyyy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("MM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dd HH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("ss\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("点击发布-发布成功")]),a._v(" "),s("h4",{attrs:{id:"获取配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取配置"}},[a._v("#")]),a._v(" 获取配置")]),a._v(" "),s("h5",{attrs:{id:"将配置交给nacos管理的步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将配置交给nacos管理的步骤"}},[a._v("#")]),a._v(" 将配置交给Nacos管理的步骤")]),a._v(" "),s("p",[a._v("在Nacos中添加配置文件\n在微服务中引入nacos的config依赖\n在微服务中添加bootstrap.yml，配置nacos地址、\n当前环境、服务名称、文件后缀名。这些决定了程序\n启动时去nacos读取哪个文件")]),a._v(" "),s("p",[a._v("项目启动-读取本地配置文件application.yml-创建spring容器-加载bean")]),a._v(" "),s("p",[a._v("Nacos会先bootstrap.yml文件拿到nacos地址后读取nacos中配置文件再去读取本地配置文件")]),a._v(" "),s("p",[a._v("bootstrap.yml：与nocos地址和配置文件有关的所有信息")]),a._v(" "),s("p",[a._v("引入Nacos的配置管理客户端依赖")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!--nacos配置管理依赖--\x3e")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-config"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("新建bootstrap.yml文件")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" userservice\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("profiles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("active")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#环境")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nacos地址")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file-extension")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yaml "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#文件后缀名")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("usercontroller")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("\t"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${pattern.dateformat}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" dateformat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"now"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LocalDateTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DateTimeFormatter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ofPattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("dateformat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("测试 localhost:8086/user/now")]),a._v(" "),s("h4",{attrs:{id:"配置自动刷新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置自动刷新"}},[a._v("#")]),a._v(" 配置自动刷新")]),a._v(" "),s("p",[a._v("Nacos中的配置文件变更后，微服务无需重启就可以感知。不过需要通过下面两种配置实现")]),a._v(" "),s("p",[a._v("方式一：在@Value注入的变量所在类上添加注解@RefreshScope")]),a._v(" "),s("p",[a._v("方式二：使用 @ConfigurationProperties 注解")]),a._v(" "),s("h4",{attrs:{id:"多环境配置共享"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多环境配置共享"}},[a._v("#")]),a._v(" 多环境配置共享")]),a._v(" "),s("p",[a._v("微服务会从nacos读取的配置文件:\n[服务名]-[spring.profile.active].yaml，环境配置\n[服务名].yaml，默认配置，多环境共享\n优先级:\n[服务名]-[环境].yaml >[服务名].yaml >本地配置")]),a._v(" "),s("p",[a._v("微服务启动时会从nacos读取多个配置文件")]),a._v(" "),s("ul",[s("li",[a._v("服务名称-开发环境.yaml userservice-dev.yaml")]),a._v(" "),s("li",[a._v("服务名称.yaml userservice.yaml")])]),a._v(" "),s("p",[a._v("无论profile如何变化userservice.yaml这个文件一定会加载，因此多环境共享配置可以写入这个文件")]),a._v(" "),s("h3",{attrs:{id:"nocos集群搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nocos集群搭建"}},[a._v("#")]),a._v(" Nocos集群搭建")])])}),[],!1,null,null,null);s.default=e.exports}}]);